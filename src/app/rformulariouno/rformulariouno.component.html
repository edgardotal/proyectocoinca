<div class="container form-container mt-1">
  <!-- Contenedor para título -->
  <div class="text-center mb-3">
    <!-- <h3 class="small-header">Recepción de Productos</h3> -->
  </div>

  <!-- Contenedor para número de control y tabla -->
  <div class="row">
    <!-- Contenedor para número de control -->
    <div class="col-md-6">
      <div class="numero-control-container mb-4">
        <label for="numeroControl" class="control-label">Control No.</label>
        <input type="text" id="numeroControl" name="numeroControl" class="form-control control-input" [value]="numeroControl" disabled>
      </div>
    </div>
  </div>

  <!-- Formulario -->
  <form [formGroup]="formulario" (ngSubmit)="onSubmit()">
    <div class="row mb-2">
      <div class="col-md-8">
        <div class="form-group">
          <label for="cliente" class="control-label">Cliente</label>
          <input type="text" id="cliente" name="cliente" class="form-control" placeholder="Cliente" formControlName="cliente" #clienteInput>
        </div>
      </div>
      <div class="col-md-4">
        <div class="form-group">
          <label for="fecha" class="control-label">Fecha Recepcion</label>
          <input type="date" id="fecha" name="fecha" class="form-control small-input" formControlName="fecha" placeholder="Fecha">
        </div>
      </div>
    </div>

    <!-- ag-Grid -->
    <ag-grid-angular
      #gridContainer  
      style="width: 100%; height: 200px;" 
      class="ag-theme-alpine"
      [rowData]="rowData"
      [columnDefs]="columnDefs"
      [gridOptions]="gridOptions"
      (gridReady)="onGridReady($event)"
      (cellFocused)="onCellFocused($event)"
      (cellValueChanged)="onCellValueChanged($event)"
      [pagination]="false"
      (rowSelected)="onRowSelected($event)">
    </ag-grid-angular>

    <!-- Tabla de Totales del grid -->
    <div class="row mt-2">
      <div class="col-sm-12">
        <div class="table-responsive">
          <table class="table table-bordered table-totales-grid">
            <thead>
              <tr>
                <th>Bruto</th>
                <th>G2,5</th>
                <th>G2,4</th>
                <th>G2,3</th>
                <th>G2,2</th>
                <th>Med.</th>
                <th>Peq.</th>
                <th>Sacos</th>
                <th>Est.</th>
                <th>Tara</th>
                <th>Neto</th>
                <th>Tot.Cesta</th>
                <th>Bultos</th>
                <th>Unidad</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>{{ brutoTotal | number:'1.2-2' }}</td>
                <td>{{ tcg25 | number:'1.2-2' }}</td>
                <td>{{ tcg24 | number:'1.2-2' }}</td>
                <td>{{ tcg23 | number:'1.2-2' }}</td>
                <td>{{ tcg22 | number:'1.2-2' }}</td>
                <td>{{ tcm | number:'1.2-2' }}</td>
                <td>{{ tcp | number:'1.2-2' }}</td>
                <td>{{ tsacos | number:'1.2-2' }}</td>
                <td>{{ testiba | number:'1.2-2' }}</td>
                <td>{{ ttara | number:'1.2-2' }}</td>
                <td>{{ tneto | number:'1.2-2' }}</td>
                <td>{{ tcestas | number:'1.2-2' }}</td>
                <td>{{ tbultos | number:'1.0-0' }}</td>
                <td>{{ tunidad | number:'1.0-0' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Nuevo Grid para Totales por lote y producto -->
    <div class="row mt-2">
      <div class="col-sm-12">
        <div class="table-responsive">
          <table class="table table-bordered table-totales-lote-producto">
            <thead>
              <tr>
                <th>Lote</th>
                <th>Producto</th>
                <th>T. Neto</th>
                <th>T. Est</th>
                <th>T. Cestas</th>
                <th>T. Gde</th>
                <th>T. Med</th>
                <th>T. Peq</th>
                <th>T. Sacos</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let total of totalesPorProductoLote">
                <td>{{ total.lote }}</td>
                <td>{{ total.producto }}</td>
                <td>{{ total.tneto | number:'1.2-2' }}</td>
                <td>{{ total.test | number:'1.2-2' }}</td>
                <td>{{ total.tcestas | number:'1.2-2' }}</td>
                <td>{{ total.tgde | number:'1.2-2' }}</td>
                <td>{{ total.tmed | number:'1.2-2' }}</td>
                <td>{{ total.tpeq | number:'1.2-2' }}</td>
                <td>{{ total.tsacos | number:'1.2-2' }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Botón de guardar -->
    <div class="row mt-2">
      <div class="col-sm-12 text-center">
        <button type="submit" class="btn btn-primary">Guardar</button>
      </div>
    </div>
  </form>
</div>

